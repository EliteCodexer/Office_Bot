{"version":3,"sources":["../../src/Structures/Message.js"],"names":["Message","constructor","data","channel","client","type","server","nonce","attachments","tts","pinned","embeds","timestamp","Date","parse","everyoneMentioned","mention_everyone","undefined","id","edited_timestamp","editedTimestamp","author","internal","users","add","content","mention","mentions","mentionData","resolver","resolveMentions","cleanContent","forEach","push","sender","toObject","keys","obj","k","channelID","serverID","map","m","isMentioned","user","resolveUser","toString","delete","deleteMessage","apply","arguments","update","updateMessage","edit","reply","replyTTS","pin","pinMessage","unpin","unpinMessage","req"],"mappings":"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","file":"Message.js","sourcesContent":["\"use strict\";\n\n/**\n * Options that can be applied to a message before sending it.\n * @typedef {(object)} MessageOptions\n * @property {boolean} [tts=false] Whether or not the message should be sent as text-to-speech.\n*/\n\nimport Cache from \"../Util/Cache\";\nimport User from \"./User\";\nimport {reg} from \"../Util/ArgumentRegulariser\";\nimport Equality from \"../Util/Equality\";\n\nexport default class Message extends Equality{\n\tconstructor(data, channel, client) {\n\t\tsuper();\n\t\tthis.type = data.type;\n\t\tthis.channel = channel;\n\t\tthis.server = channel.server;\n\t\tthis.client = client;\n\t\tthis.nonce = data.nonce;\n\t\tthis.attachments = data.attachments;\n\t\tthis.tts = data.tts;\n\t\tthis.pinned = data.pinned;\n\t\tthis.embeds = data.embeds;\n\t\tthis.timestamp = Date.parse(data.timestamp);\n\t\tthis.everyoneMentioned = data.mention_everyone !== undefined ? data.mention_everyone : data.everyoneMentioned;\n\t\tthis.pinned = data.pinned;\n\t\tthis.id = data.id;\n\n\t\tif(data.edited_timestamp) {\n\t\t\tthis.editedTimestamp = Date.parse(data.edited_timestamp);\n\t\t}\n\n\t\tif(data.author instanceof User) {\n\t\t\tthis.author = data.author;\n\t\t} else if(data.author) {\n\t\t\tthis.author = client.internal.users.add(new User(data.author, client));\n\t\t}\n\n\t\tthis.content = data.content;\n\t\tif(!this.type) {\n\t\t} else if(this.type === 1) {\n\t\t\tthis.content = this.author.mention() + \" added <@\" + data.mentions[0].id + \">.\";\n\t\t} else if(this.type === 2) {\n\t\t\tif(this.author.id === data.mentions[0].id) {\n\t\t\t\tthis.content = this.author.mention() + \" left the group.\";\n\t\t\t} else {\n\t\t\t\tthis.content = this.author.mention() + \" removed <@\" + data.mentions[0].id + \">.\";\n\t\t\t}\n\t\t} else if(this.type === 3) {\n\t\t\tthis.content = this.author.mention() + \" started a call.\";\n\t\t} else if(this.type === 4) {\n\t\t\tthis.content = this.author.mention() + \" changed the channel name: \" + data.content;\n\t\t} else if(this.type === 5) {\n\t\t\tthis.content = this.author.mention() + \" changed the channel icon.\";\n\t\t} else if(this.type === 6) {\n\t\t\tthis.content = this.author.mention() + \" pinned a message to this channel. See all the pins.\";\n\t\t}\n\n\t\tvar mentionData = client.internal.resolver.resolveMentions(data.content, channel);\n\t\tthis.cleanContent = mentionData[1];\n\t\tthis.mentions = [];\n\n\t\tmentionData[0].forEach((mention) => {\n\t\t\t// this is .add and not .get because it allows the bot to cache\n\t\t\t// users from messages from logs who may have left the server and were\n\t\t\t// not previously cached.\n\t\t\tif(mention instanceof User) {\n\t\t\t\tthis.mentions.push(mention);\n\t\t\t} else {\n\t\t\t\tthis.mentions.push(client.internal.users.add(new User(mention, client)));\n\t\t\t}\n\t\t});\n\t}\n\n\tget sender(){\n\t\treturn this.author;\n\t}\n\n\ttoObject() {\n\t\tlet keys = ['id', 'timestamp', 'everyoneMentioned', 'pinned', 'editedTimestamp', 'content', 'cleanContent', 'tts', 'attachments', 'embeds'],\n\t\t\tobj = {};\n\n\t\tfor (let k of keys) {\n\t\t\tobj[k] = this[k];\n\t\t}\n\n\t\tobj.channelID = this.channel ? this.channel.id : null;\n\t\tobj.serverID = this.server ? this.server.id : null;\n\t\tobj.author = this.author.toObject();\n\t\tobj.mentions = this.mentions.map(m => m.toObject());\n\n\t\treturn obj;\n\t}\n\n\tisMentioned(user){\n\t\tuser = this.client.internal.resolver.resolveUser(user);\n\t\tif (!user) {\n\t\t\treturn false\n\t\t}\n\t\tfor (var mention of this.mentions) {\n\t\t\tif (mention.id == user.id) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\ttoString(){\n\t\treturn this.content;\n\t}\n\n\tdelete(){\n\t\treturn this.client.deleteMessage.apply(this.client, reg(this, arguments));\n\t}\n\n\tupdate(){\n\t\treturn this.client.updateMessage.apply(this.client, reg(this, arguments));\n\t}\n\n\tedit() {\n\t\treturn this.client.updateMessage.apply(this.client, reg(this, arguments));\n\t}\n\n\treply(){\n\t\treturn this.client.reply.apply(this.client, reg(this, arguments));\n\t}\n\n\treplyTTS(){\n\t\treturn this.client.replyTTS.apply(this.client, reg(this, arguments));\n\t}\n\n\tpin() {\n\t\treturn this.client.pinMessage.apply(this.client, reg(this, arguments));\n\t}\n\n\tunpin() {\n\t\treturn this.client.unpinMessage.apply(this.client, req(this, arguments));\n\t}\n}\n"]}