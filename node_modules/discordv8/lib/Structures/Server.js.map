{"version":3,"sources":["../../src/Structures/Server.js"],"names":["strictKeys","Server","constructor","data","client","id","owner_id","internal","buckets","region","ownerID","name","members","channels","roles","emojis","icon","afkTimeout","afk_timeout","afkChannelID","afk_channel_id","memberMap","memberCount","member_count","large","forEach","role","add","dataRole","emoji","dataEmoji","member","dataUser","user","mute","selfMute","self_mute","deaf","selfDeaf","self_deaf","joinedAt","Date","parse","joined_at","nick","users","channel","dataChannel","type","presences","presence","get","status","game","voice_states","options","bot","voiceState","user_id","undefined","channel_id","eventVoiceJoin","emit","pendingVoiceStates","webhooks","map","c","reduce","previousChannel","currentChannel","webhook","createdAt","toObject","keys","obj","k","detailsOf","resolver","resolveUser","result","pid","detailsOfUser","detailsOfMember","details","rolesOfUser","rolesOfMember","rolesOf","iconURL","SERVER_ICON","afkChannel","defaultChannel","generalChannel","general","owner","toString","oldChannel","eventVoiceLeave","voiceChannel","eventVoiceStateUpdate","oldState","chan","getAll","has","remove","server","equalsStrict","key","leave","leaveServer","apply","arguments","delete","createInvite","createRole","banMember","tlength","callback","banUser","ban","unbanMember","unbanUser","unban","kickMember","kickUser","kick","getBans","createChannel","setNickname","membersWithRole","filter","m","hasRole","usersWithRole"],"mappings":"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","file":"Server.js","sourcesContent":["\"use strict\";\n\n/**\n * Types of region for a server, include: `us-west`, `us-east`, `us-south`, `us-central`, `singapore`, `london`, `sydney`, `amsterdam` and `frankfurt`\n * @typedef {(string)} region\n */\n\nimport Bucket from \"../Util/Bucket\";\nimport Equality from \"../Util/Equality\";\nimport {Endpoints} from \"../Constants\";\nimport Cache from \"../Util/Cache\";\nimport User from \"./User\";\nimport TextChannel from \"./TextChannel\";\nimport VoiceChannel from \"./VoiceChannel\";\nimport Role from \"./Role\";\nimport Emoji from \"./Emoji\";\nimport {reg} from \"../Util/ArgumentRegulariser\";\n\nvar strictKeys = [\n\t\"region\", \"ownerID\", \"name\", \"id\", \"icon\", \"afkTimeout\", \"afkChannelID\"\n];\n\nexport default class Server extends Equality {\n\n\tconstructor(data, client) {\n\n\t\tsuper();\n\n\t\tthis.client = client;\n\t\tthis.id = data.id;\n\n\t\tif(data.owner_id) { // new server data\n\t\t    client.internal.buckets[\"bot:msg:guild:\" + this.id] = new Bucket(5, 5000);\n            client.internal.buckets[\"dmsg:\" + this.id] = new Bucket(5, 1000);\n            client.internal.buckets[\"bdmsg:\" + this.id] = new Bucket(1, 1000);\n            client.internal.buckets[\"guild_member:\" + this.id] = new Bucket(10, 10000);\n            client.internal.buckets[\"guild_member_nick:\" + this.id] = new Bucket(1, 1000);\n        }\n\n\t\tthis.region = data.region;\n\t\tthis.ownerID = data.owner_id || data.ownerID;\n\t\tthis.name = data.name;\n\t\tthis.members = new Cache();\n\t\tthis.channels = new Cache();\n\t\tthis.roles = new Cache();\n\t\tthis.emojis = new Cache();\n\t\tthis.icon = data.icon;\n\t\tthis.afkTimeout = data.afk_timeout;\n\t\tthis.afkChannelID = data.afk_channel_id || data.afkChannelID;\n\t\tthis.memberMap = data.memberMap || {};\n\t\tthis.memberCount = data.member_count || data.memberCount;\n\t\tthis.large = data.large || this.memberCount > 250;\n\n\t\tif (data.roles instanceof Cache) {\n\t\t\tdata.roles.forEach((role) => this.roles.add(role));\n\t\t} else {\n\t\t\tdata.roles.forEach((dataRole) => {\n\t\t\t\tthis.roles.add(new Role(dataRole, this, client));\n\t\t\t});\n\t\t}\n\n\t\tif (data.emojis instanceof Cache) {\n\t\t\tdata.emojis.forEach((emoji) => this.emojis.add(emoji));\n\t\t} else {\n\t\t\tdata.emojis.forEach((dataEmoji) => {\n\t\t\t\tthis.emojis.add(new Emoji(dataEmoji, this));\n\t\t\t})\n\t\t}\n\n\t\tif (data.members instanceof Cache) {\n\t\t\tdata.members.forEach((member) => this.members.add(member));\n\t\t} else {\n\t\t\tdata.members.forEach((dataUser) => {\n\t\t\t\tthis.memberMap[dataUser.user.id] = {\n\t\t\t\t\troles: dataUser.roles,\n\t\t\t\t\tmute: dataUser.mute,\n\t\t\t\t\tselfMute: dataUser.self_mute,\n\t\t\t\t\tdeaf: dataUser.deaf,\n\t\t\t\t\tselfDeaf: dataUser.self_deaf,\n\t\t\t\t\tjoinedAt: Date.parse(dataUser.joined_at),\n\t\t\t\t\tnick: dataUser.nick || null\n\t\t\t\t};\n\t\t\t\tthis.members.add(client.internal.users.add(new User(dataUser.user, client)));\n\t\t\t});\n\t\t}\n\n\t\tif (data.channels instanceof Cache) {\n\t\t\tdata.channels.forEach((channel) => this.channels.add(channel));\n\t\t} else {\n\t\t\tdata.channels.forEach((dataChannel) => {\n\t\t\t\tif (dataChannel.type === 0) {\n\t\t\t\t\tthis.channels.add(client.internal.channels.add(new TextChannel(dataChannel, client, this)));\n\t\t\t\t} else {\n\t\t\t\t\tthis.channels.add(client.internal.channels.add(new VoiceChannel(dataChannel, client, this)));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (data.presences) {\n\t\t\tfor (var presence of data.presences) {\n\t\t\t\tvar user = client.internal.users.get(\"id\", presence.user.id);\n\t\t\t\tif(user) {\n\t\t\t\t\tuser.status = presence.status;\n\t\t\t\t\tuser.game = presence.game;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (data.voice_states) {\n\t\t\tif(this.client.options.bot) {\n\t\t\t\tfor (var voiceState of data.voice_states) {\n\t\t\t\t\tlet user = this.members.get(\"id\", voiceState.user_id);\n\t\t\t\t\tif (user) {\n\t\t\t\t\t\tthis.memberMap[user.id] = this.memberMap[user.id] || {};\n\t\t\t\t\t\tthis.memberMap[user.id].mute = voiceState.mute || this.memberMap[user.id].mute;\n\t\t\t\t\t\tthis.memberMap[user.id].selfMute = voiceState.self_mute === undefined ? this.memberMap[user.id].selfMute : voiceState.self_mute;\n\t\t\t\t\t\tthis.memberMap[user.id].deaf = voiceState.deaf || this.memberMap[user.id].deaf;\n\t\t\t\t\t\tthis.memberMap[user.id].selfDeaf = voiceState.self_deaf === undefined ? this.memberMap[user.id].selfDeaf : voiceState.self_deaf;\n\t\t\t\t\t\tlet channel = this.channels.get(\"id\", voiceState.channel_id);\n\t\t\t\t\t\tif (channel) {\n\t\t\t\t\t\t\tthis.eventVoiceJoin(user, channel);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.client.emit(\"warn\", \"channel doesn't exist even though READY expects them to\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.client.emit(\"warn\", \"user doesn't exist even though READY expects them to\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.pendingVoiceStates = data.voice_states;\n\t\t\t}\n\t\t}\n\t}\n\n\tget webhooks() {\n\t\treturn this.channels\n\t\t\t.map(c => c.webhooks)\n\t\t\t.reduce((previousChannel, currentChannel) => {\n\t\t\t\tif (currentChannel) {\n\t\t\t\t\tcurrentChannel.forEach(webhook => {\n\t\t\t\t\t\tpreviousChannel.add(webhook);\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\treturn previousChannel;\n\t\t\t}, new Cache(\"id\"));\n\t}\n\n\tget createdAt() {\n\t\treturn new Date((+this.id / 4194304) + 1420070400000);\n\t}\n\n\ttoObject() {\n\t\tvar keys = ['id', 'name', 'region', 'ownerID', 'icon', 'afkTimeout', 'afkChannelID', 'large', 'memberCount'],\n\t\t\tobj = {};\n\n\t\tfor (let k of keys) {\n\t\t\tobj[k] = this[k];\n\t\t}\n\n\t\tobj.members = this.members.map(member => member.toObject());\n\t\tobj.channels = this.channels.map(channel => channel.toObject());\n\t\tobj.roles = this.roles.map(role => role.toObject());\n\t\tobj.emojis = this.emojis.map(emoji => emoji.toObject());\n\n\t\treturn obj;\n\t}\n\n\tdetailsOf(user) {\n\t\tuser = this.client.internal.resolver.resolveUser(user);\n\t\tif (user) {\n\t\t\tvar result = this.memberMap[user.id] || {};\n\t\t\tif(result && result.roles) {\n\t\t\t\tresult.roles = result.roles.map(pid => this.roles.get(\"id\", pid) || pid);\n\t\t\t}\n\t\t\treturn result;\n\t\t} else {\n\t\t\treturn {};\n\t\t}\n\t}\n\n\tdetailsOfUser(user) {\n\t\treturn this.detailsOf(user);\n\t}\n\n\tdetailsOfMember(user) {\n\t\treturn this.detailsOf(user);\n\t}\n\n\tdetails(user) {\n\t\treturn this.detailsOf(user);\n\t}\n\n\trolesOfUser(user) {\n\t\treturn this.detailsOf(user).roles || [];\n\t}\n\n\trolesOfMember(member) {\n\t\treturn this.rolesOfUser(member);\n\t}\n\n\trolesOf(user) {\n\t\treturn this.rolesOfUser(user);\n\t}\n\n\tget iconURL() {\n\t\tif (!this.icon) {\n\t\t\treturn null;\n\t\t} else {\n\t\t\treturn Endpoints.SERVER_ICON(this.id, this.icon);\n\t\t}\n\t}\n\n\tget afkChannel() {\n\t\treturn this.channels.get(\"id\", this.afkChannelID);\n\t}\n\n\tget defaultChannel() {\n\t\treturn this.channels.get(\"id\", this.id);\n\t}\n\n\tget generalChannel() {\n\t\treturn this.defaultChannel;\n\t}\n\n\tget general() {\n\t\treturn this.defaultChannel;\n\t}\n\n\tget owner() {\n\t\treturn this.members.get(\"id\", this.ownerID);\n\t}\n\n\ttoString() {\n\t\treturn this.name;\n\t}\n\n\teventVoiceJoin(user, channel) {\n\t\t// removes from other speaking channels first\n\t\tvar oldChannel = this.eventVoiceLeave(user);\n\n\t\tchannel.members.add(user);\n\t\tuser.voiceChannel = channel;\n\n\t\tif (oldChannel.id && channel.id !== oldChannel.id) {\n\t\t\tthis.client.emit(\"voiceLeave\", oldChannel, user);\n\t\t\tthis.client.emit(\"voiceSwitch\", oldChannel, channel, user);\n\t\t}\n\n\t\tthis.client.emit(\"voiceJoin\", channel, user);\n\t}\n\n\teventVoiceStateUpdate(channel, user, data) {\n\t\tif (!user.voiceChannel || user.voiceChannel.id !== channel.id) {\n\t\t\treturn this.eventVoiceJoin(user, channel);\n\t\t}\n\t\tif (!this.memberMap[user.id]) {\n\t\t\tthis.memberMap[user.id] = {};\n\t\t}\n\t\tvar oldState = {\n\t\t\tmute: this.memberMap[user.id].mute,\n\t\t\tselfMute: this.memberMap[user.id].self_mute,\n\t\t\tdeaf: this.memberMap[user.id].deaf,\n\t\t\tselfDeaf: this.memberMap[user.id].self_deaf\n\t\t};\n\t\tthis.memberMap[user.id].mute = data.mute;\n\t\tthis.memberMap[user.id].selfMute = data.self_mute;\n\t\tthis.memberMap[user.id].deaf = data.deaf;\n\t\tthis.memberMap[user.id].selfDeaf = data.self_deaf;\n\t\tif (oldState.mute !== undefined && (oldState.mute != data.mute || oldState.self_mute != data.self_mute\n\t\t\t|| oldState.deaf != data.deaf || oldState.self_deaf != data.self_deaf)) {\n\t\t\tthis.client.emit(\"voiceStateUpdate\", channel, user, oldState, this.memberMap[user.id]);\n\t\t} else {\n\t\t\tthis.eventVoiceJoin(user, channel);\n\t\t}\n\t}\n\n\teventVoiceLeave(user) {\n\t\tfor (let chan of this.channels.getAll(\"type\", 2)) {\n\t\t\tif (chan.members.has(\"id\", user.id)) {\n\t\t\t\tchan.members.remove(user);\n\t\t\t\tuser.voiceChannel = null;\n\t\t\t\treturn chan;\n\t\t\t}\n\t\t}\n\t\treturn {server: this};\n\t}\n\n\tequalsStrict(obj) {\n\t\tif (obj instanceof Server) {\n\t\t\tfor (var key of strictKeys) {\n\t\t\t\tif (obj[key] !== this[key]) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tleave() {\n\t\treturn this.client.leaveServer.apply(this.client, reg(this, arguments));\n\t}\n\n\tdelete() {\n\t\treturn this.client.leaveServer.apply(this.client, reg(this, arguments));\n\t}\n\n\tcreateInvite() {\n\t\treturn this.client.createInvite.apply(this.client, reg(this, arguments));\n\t}\n\n\tcreateRole() {\n\t\treturn this.client.createRole.apply(this.client, reg(this, arguments));\n\t}\n\n\tbanMember(user, tlength, callback) {\n\t\treturn this.client.banMember.apply(this.client, [user, this, tlength, callback]);\n\t}\n\n\tbanUser(user, tlength, callback) {\n\t\treturn this.client.banMember.apply(this.client, [user, this, tlength, callback]);\n\t}\n\n\tban(user, tlength, callback) {\n\t\treturn this.client.banMember.apply(this.client, [user, this, tlength, callback]);\n\t}\n\n\tunbanMember(user, callback) {\n\t\treturn this.client.unbanMember.apply(this.client, [user, this, callback]);\n\t}\n\n\tunbanUser(user, callback) {\n\t\treturn this.client.unbanMember.apply(this.client, [user, this, callback]);\n\t}\n\n\tunban(user, callback) {\n\t\treturn this.client.unbanMember.apply(this.client, [user, this, callback]);\n\t}\n\n\tkickMember(user, callback) {\n\t\treturn this.client.kickMember.apply(this.client, [user, this, callback]);\n\t}\n\n\tkickUser(user, callback) {\n\t\treturn this.client.kickMember.apply(this.client, [user, this, callback]);\n\t}\n\n\tkick(user, callback) {\n\t\treturn this.client.kickMember.apply(this.client, [user, this, callback]);\n\t}\n\n\tgetBans() {\n\t\treturn this.client.getBans.apply(this.client, reg(this, arguments));\n\t}\n\n\tcreateChannel() {\n\t\treturn this.client.createChannel.apply(this.client, reg(this, arguments));\n\t}\n\n\tsetNickname() {\n\t\treturn this.client.setNickname.apply(this.client, reg(this, arguments));\n\t}\n\n\tmembersWithRole(role) {\n\t\treturn this.members.filter(m => m.hasRole(role));\n\t}\n\n\tusersWithRole(role) {\n\t\treturn this.membersWithRole(role);\n\t}\n}\n"]}