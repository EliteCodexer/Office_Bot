{"version":3,"sources":["../../src/Voice/VoicePacket.js"],"names":["nacl","require","e","nonce","Buffer","fill","VoicePacket","constructor","data","sequence","time","ssrc","secret","Error","mac","packetLength","length","audioBuffer","returnBuffer","writeUIntBE","copy","secretbox","i"],"mappings":"AAAA;;;;;AAEA,IAAIA,IAAJ;AACA,IAAI;AACHA,QAAOC,QAAQ,WAAR,CAAP;AACA,CAFD,CAEE,OAAOC,CAAP,EAAU;AACX;AACA;;AAED,MAAMC,QAAQ,IAAIC,MAAJ,CAAW,EAAX,CAAd;AACAD,MAAME,IAAN,CAAW,CAAX;;AAEe,MAAMC,WAAN,CAAkB;AAChCC,aAAYC,IAAZ,EAAkBC,QAAlB,EAA4BC,IAA5B,EAAkCC,IAAlC,EAAwCC,MAAxC,EAA+C;AAC9C,MAAG,CAACZ,IAAJ,EAAU;AACT,SAAM,IAAIa,KAAJ,CAAU,qDAAV,CAAN;AACA;AACD,MAAIC,MAAMF,SAAS,EAAT,GAAc,CAAxB;AACA,MAAIG,eAAeP,KAAKQ,MAAL,GAAc,EAAd,GAAmBF,GAAtC;;AAEA,MAAIG,cAAcT,IAAlB;AACA,MAAIU,eAAe,IAAId,MAAJ,CAAWW,YAAX,CAAnB;;AAEAG,eAAab,IAAb,CAAkB,CAAlB;AACAa,eAAa,CAAb,IAAkB,IAAlB;AACAA,eAAa,CAAb,IAAkB,IAAlB;;AAEAA,eAAaC,WAAb,CAAyBV,QAAzB,EAAmC,CAAnC,EAAsC,CAAtC;AACAS,eAAaC,WAAb,CAAyBT,IAAzB,EAA+B,CAA/B,EAAkC,CAAlC;AACAQ,eAAaC,WAAb,CAAyBR,IAAzB,EAA+B,CAA/B,EAAkC,CAAlC;;AAEA,MAAIC,MAAJ,EAAY;AACX;AACAM,gBAAaE,IAAb,CAAkBjB,KAAlB,EAAyB,CAAzB,EAA4B,CAA5B,EAA+B,EAA/B;AACAc,iBAAcjB,KAAKqB,SAAL,CAAeb,IAAf,EAAqBL,KAArB,EAA4BS,MAA5B,CAAd;AACA;;AAED,OAAK,IAAIU,IAAI,CAAb,EAAgBA,IAAIL,YAAYD,MAAhC,EAAwCM,GAAxC,EAA6C;AAC5CJ,gBAAaI,IAAI,EAAjB,IAAuBL,YAAYK,CAAZ,CAAvB;AACA;;AAED,SAAOJ,YAAP;AAEA;AA/B+B;kBAAZZ,W","file":"VoicePacket.js","sourcesContent":["\"use strict\";\n\nvar nacl;\ntry {\n\tnacl = require(\"tweetnacl\");\n} catch (e) {\n\t// no tweetnacl!\n}\n\nconst nonce = new Buffer(24);\nnonce.fill(0);\n\nexport default class VoicePacket {\n\tconstructor(data, sequence, time, ssrc, secret){\n\t\tif(!nacl) {\n\t\t\tthrow new Error(\"tweetnacl not found! Perhaps you didn't install it.\");\n\t\t}\n\t\tvar mac = secret ? 16 : 0;\n\t\tvar packetLength = data.length + 12 + mac;\n\n\t\tvar audioBuffer = data;\n\t\tvar returnBuffer = new Buffer(packetLength);\n\n\t\treturnBuffer.fill(0);\n\t\treturnBuffer[0] = 0x80;\n\t\treturnBuffer[1] = 0x78;\n\n\t\treturnBuffer.writeUIntBE(sequence, 2, 2);\n\t\treturnBuffer.writeUIntBE(time, 4, 4);\n\t\treturnBuffer.writeUIntBE(ssrc, 8, 4);\n\n\t\tif (secret) {\n\t\t\t// copy first 12 bytes\n\t\t\treturnBuffer.copy(nonce, 0, 0, 12);\n\t\t\taudioBuffer = nacl.secretbox(data, nonce, secret);\n\t\t}\n\n\t\tfor (var i = 0; i < audioBuffer.length; i++) {\n\t\t\treturnBuffer[i + 12] = audioBuffer[i];\n\t\t}\n\n\t\treturn returnBuffer;\n\n\t}\n}\n"]}