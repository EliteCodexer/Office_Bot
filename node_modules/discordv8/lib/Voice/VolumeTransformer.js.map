{"version":3,"sources":["../../src/Voice/VolumeTransformer.js"],"names":["Transform","require","Volume","constructor","volume","set","_volume","undefined","value","setVolumeLogarithmic","Math","pow","setVolumeDecibels","db","multiplier","get","_transform","buffer","encoding","callback","out","Buffer","length","i","uint","floor","readInt16LE","min","max","writeInt16LE","push","module","exports"],"mappings":";;AAAA,MAAMA,YAAYC,QAAQ,QAAR,EAAkBD,SAApC;;AAEA;;;AAGA,MAAME,MAAN,SAAqBF,SAArB,CAA+B;AAC9BG,aAAYC,MAAZ,EAAoB;AACnB;AACA,OAAKC,GAAL,CAASD,MAAT;AACA;;AAED,KAAIA,MAAJ,GAAa;AACZ,SAAO,KAAKE,OAAL,KAAiBC,SAAjB,GAA6B,CAA7B,GAAiC,KAAKD,OAA7C;AACA;;AAED,KAAIF,MAAJ,CAAWI,KAAX,EAAkB;AACjB,OAAKF,OAAL,GAAeE,KAAf;AACA;;AAED;AACA;AACAC,sBAAqBD,KAArB,EAA4B;AAC3B,OAAKJ,MAAL,GAAcM,KAAKC,GAAL,CAASH,KAAT,EAAgB,QAAhB,CAAd;AACA;;AAED;AACAI,mBAAkBC,EAAlB,EAAsB;AACrB,OAAKT,MAAL,GAAcM,KAAKC,GAAL,CAAS,EAAT,EAAaE,KAAK,EAAlB,CAAd;AACA;;AAED,KAAIC,UAAJ,GAAiB;AAChB,SAAO,KAAKV,MAAZ;AACA;;AAEDW,OAAM;AACL,SAAO,KAAKX,MAAZ;AACA;;AAEDC,KAAID,MAAJ,EAAY;AACX,OAAKA,MAAL,GAAcA,WAAWG,SAAX,GAAuB,CAAvB,GAA2BH,MAAzC;AACA;;AAEDY,YAAWC,MAAX,EAAmBC,QAAnB,EAA6BC,QAA7B,EAAuC;AACtC,MAAIC,MAAM,IAAIC,MAAJ,CAAWJ,OAAOK,MAAlB,CAAV;;AAEA,OAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIN,OAAOK,MAA3B,EAAmCC,KAAK,CAAxC,EAA2C;AAC1C;AACA;AACA;AACA,OAAIA,KAAKN,OAAOK,MAAP,GAAgB,CAAzB,EAA4B;AAC3B;AACA;;AAED;AACA;AACA,OAAIE,OAAOd,KAAKe,KAAL,CAAW,KAAKX,UAAL,GAAkBG,OAAOS,WAAP,CAAmBH,CAAnB,CAA7B,CAAX;;AAEA;AACAC,UAAOd,KAAKiB,GAAL,CAAS,KAAT,EAAgBH,IAAhB,CAAP;AACAA,UAAOd,KAAKkB,GAAL,CAAS,CAAC,KAAV,EAAiBJ,IAAjB,CAAP;;AAEA;AACAJ,OAAIS,YAAJ,CAAiBL,IAAjB,EAAuBD,CAAvB;AACA;;AAED,OAAKO,IAAL,CAAUV,GAAV;AACAD;AACA;AA9D6B;;AAiE/BY,OAAOC,OAAP,GAAiB9B,MAAjB","file":"VolumeTransformer.js","sourcesContent":["const Transform = require('stream').Transform;\n\n/**\n * @see https://github.com/reneraab/pcm-volume/blob/master/index.js Inspired by this script\n */\nclass Volume extends Transform {\n\tconstructor(volume) {\n\t\tsuper();\n\t\tthis.set(volume);\n\t}\n\n\tget volume() {\n\t\treturn this._volume === undefined ? 1 : this._volume;\n\t}\n\n\tset volume(value) {\n\t\tthis._volume = value;\n\t}\n\n\t// Set the volume so that a value of 0.5 is half the perceived volume and\n\t// 2.0 is double the perceived volume.\n\tsetVolumeLogarithmic(value) {\n\t\tthis.volume = Math.pow(value, 1.660964);\n\t}\n\n\t// Set the volume to a value specified as decibels.\n\tsetVolumeDecibels(db) {\n\t\tthis.volume = Math.pow(10, db / 20);\n\t}\n\n\tget multiplier() {\n\t\treturn this.volume;\n\t}\n\n\tget() {\n\t\treturn this.volume;\n\t}\n\n\tset(volume) {\n\t\tthis.volume = volume === undefined ? 1 : volume;\n\t}\n\n\t_transform(buffer, encoding, callback) {\n\t\tlet out = new Buffer(buffer.length);\n\n\t\tfor (let i = 0; i < buffer.length; i += 2) {\n\t\t\t// Check whether the index is actually in range - sometimes it's possible\n\t\t\t// that it skips ahead too far before the end condition of the for can\n\t\t\t// kick in.\n\t\t\tif (i >= buffer.length - 1) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// Read Int16, multiple with multiplier and round down\n\t\t\t//console.log(this.volume, this.multiplier, buffer.readInt16LE(i));\n\t\t\tlet uint = Math.floor(this.multiplier * buffer.readInt16LE(i));\n\n\t\t\t// Ensure value stays within 16bit\n\t\t\tuint = Math.min(32767, uint);\n\t\t\tuint = Math.max(-32767, uint);\n\n\t\t\t// Write 2 new bytes into other buffer;\n\t\t\tout.writeInt16LE(uint, i);\n\t\t}\n\n\t\tthis.push(out);\n\t\tcallback();\n\t}\n}\n\nmodule.exports = Volume;\n"]}