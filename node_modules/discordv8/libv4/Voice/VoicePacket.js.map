{"version":3,"sources":["../../src/Voice/VoicePacket.js"],"names":["nacl","require","e","nonce","Buffer","fill","VoicePacket","data","sequence","time","ssrc","secret","Error","mac","packetLength","length","audioBuffer","returnBuffer","writeUIntBE","copy","secretbox","i"],"mappings":"AAAA;;;;;;;;AAEA,IAAIA,IAAJ;AACA,IAAI;AACHA,QAAOC,QAAQ,WAAR,CAAP;AACA,CAFD,CAEE,OAAOC,CAAP,EAAU;AACX;AACA;;AAED,IAAMC,QAAQ,IAAIC,MAAJ,CAAW,EAAX,CAAd;AACAD,MAAME,IAAN,CAAW,CAAX;;IAEqBC,W,GACpB,qBAAYC,IAAZ,EAAkBC,QAAlB,EAA4BC,IAA5B,EAAkCC,IAAlC,EAAwCC,MAAxC,EAA+C;AAAA;;AAC9C,KAAG,CAACX,IAAJ,EAAU;AACT,QAAM,IAAIY,KAAJ,CAAU,qDAAV,CAAN;AACA;AACD,KAAIC,MAAMF,SAAS,EAAT,GAAc,CAAxB;AACA,KAAIG,eAAeP,KAAKQ,MAAL,GAAc,EAAd,GAAmBF,GAAtC;;AAEA,KAAIG,cAAcT,IAAlB;AACA,KAAIU,eAAe,IAAIb,MAAJ,CAAWU,YAAX,CAAnB;;AAEAG,cAAaZ,IAAb,CAAkB,CAAlB;AACAY,cAAa,CAAb,IAAkB,IAAlB;AACAA,cAAa,CAAb,IAAkB,IAAlB;;AAEAA,cAAaC,WAAb,CAAyBV,QAAzB,EAAmC,CAAnC,EAAsC,CAAtC;AACAS,cAAaC,WAAb,CAAyBT,IAAzB,EAA+B,CAA/B,EAAkC,CAAlC;AACAQ,cAAaC,WAAb,CAAyBR,IAAzB,EAA+B,CAA/B,EAAkC,CAAlC;;AAEA,KAAIC,MAAJ,EAAY;AACX;AACAM,eAAaE,IAAb,CAAkBhB,KAAlB,EAAyB,CAAzB,EAA4B,CAA5B,EAA+B,EAA/B;AACAa,gBAAchB,KAAKoB,SAAL,CAAeb,IAAf,EAAqBJ,KAArB,EAA4BQ,MAA5B,CAAd;AACA;;AAED,MAAK,IAAIU,IAAI,CAAb,EAAgBA,IAAIL,YAAYD,MAAhC,EAAwCM,GAAxC,EAA6C;AAC5CJ,eAAaI,IAAI,EAAjB,IAAuBL,YAAYK,CAAZ,CAAvB;AACA;;AAED,QAAOJ,YAAP;AAEA,C;;kBA/BmBX,W","file":"VoicePacket.js","sourcesContent":["\"use strict\";\n\nvar nacl;\ntry {\n\tnacl = require(\"tweetnacl\");\n} catch (e) {\n\t// no tweetnacl!\n}\n\nconst nonce = new Buffer(24);\nnonce.fill(0);\n\nexport default class VoicePacket {\n\tconstructor(data, sequence, time, ssrc, secret){\n\t\tif(!nacl) {\n\t\t\tthrow new Error(\"tweetnacl not found! Perhaps you didn't install it.\");\n\t\t}\n\t\tvar mac = secret ? 16 : 0;\n\t\tvar packetLength = data.length + 12 + mac;\n\n\t\tvar audioBuffer = data;\n\t\tvar returnBuffer = new Buffer(packetLength);\n\n\t\treturnBuffer.fill(0);\n\t\treturnBuffer[0] = 0x80;\n\t\treturnBuffer[1] = 0x78;\n\n\t\treturnBuffer.writeUIntBE(sequence, 2, 2);\n\t\treturnBuffer.writeUIntBE(time, 4, 4);\n\t\treturnBuffer.writeUIntBE(ssrc, 8, 4);\n\n\t\tif (secret) {\n\t\t\t// copy first 12 bytes\n\t\t\treturnBuffer.copy(nonce, 0, 0, 12);\n\t\t\taudioBuffer = nacl.secretbox(data, nonce, secret);\n\t\t}\n\n\t\tfor (var i = 0; i < audioBuffer.length; i++) {\n\t\t\treturnBuffer[i + 12] = audioBuffer[i];\n\t\t}\n\n\t\treturn returnBuffer;\n\n\t}\n}\n"]}