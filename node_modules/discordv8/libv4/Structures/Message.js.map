{"version":3,"sources":["../../src/Structures/Message.js"],"names":["Message","data","channel","client","type","server","nonce","attachments","tts","pinned","embeds","timestamp","Date","parse","everyoneMentioned","mention_everyone","undefined","id","edited_timestamp","editedTimestamp","author","internal","users","add","content","mention","mentions","mentionData","resolver","resolveMentions","cleanContent","forEach","push","keys","obj","k","channelID","serverID","toObject","map","m","user","resolveUser","deleteMessage","apply","arguments","updateMessage","reply","replyTTS","pinMessage","unpinMessage","req"],"mappings":"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","file":"Message.js","sourcesContent":["\"use strict\";\n\n/**\n * Options that can be applied to a message before sending it.\n * @typedef {(object)} MessageOptions\n * @property {boolean} [tts=false] Whether or not the message should be sent as text-to-speech.\n*/\n\nimport Cache from \"../Util/Cache\";\nimport User from \"./User\";\nimport {reg} from \"../Util/ArgumentRegulariser\";\nimport Equality from \"../Util/Equality\";\n\nexport default class Message extends Equality{\n\tconstructor(data, channel, client) {\n\t\tsuper();\n\t\tthis.type = data.type;\n\t\tthis.channel = channel;\n\t\tthis.server = channel.server;\n\t\tthis.client = client;\n\t\tthis.nonce = data.nonce;\n\t\tthis.attachments = data.attachments;\n\t\tthis.tts = data.tts;\n\t\tthis.pinned = data.pinned;\n\t\tthis.embeds = data.embeds;\n\t\tthis.timestamp = Date.parse(data.timestamp);\n\t\tthis.everyoneMentioned = data.mention_everyone !== undefined ? data.mention_everyone : data.everyoneMentioned;\n\t\tthis.pinned = data.pinned;\n\t\tthis.id = data.id;\n\n\t\tif(data.edited_timestamp) {\n\t\t\tthis.editedTimestamp = Date.parse(data.edited_timestamp);\n\t\t}\n\n\t\tif(data.author instanceof User) {\n\t\t\tthis.author = data.author;\n\t\t} else if(data.author) {\n\t\t\tthis.author = client.internal.users.add(new User(data.author, client));\n\t\t}\n\n\t\tthis.content = data.content;\n\t\tif(!this.type) {\n\t\t} else if(this.type === 1) {\n\t\t\tthis.content = this.author.mention() + \" added <@\" + data.mentions[0].id + \">.\";\n\t\t} else if(this.type === 2) {\n\t\t\tif(this.author.id === data.mentions[0].id) {\n\t\t\t\tthis.content = this.author.mention() + \" left the group.\";\n\t\t\t} else {\n\t\t\t\tthis.content = this.author.mention() + \" removed <@\" + data.mentions[0].id + \">.\";\n\t\t\t}\n\t\t} else if(this.type === 3) {\n\t\t\tthis.content = this.author.mention() + \" started a call.\";\n\t\t} else if(this.type === 4) {\n\t\t\tthis.content = this.author.mention() + \" changed the channel name: \" + data.content;\n\t\t} else if(this.type === 5) {\n\t\t\tthis.content = this.author.mention() + \" changed the channel icon.\";\n\t\t} else if(this.type === 6) {\n\t\t\tthis.content = this.author.mention() + \" pinned a message to this channel. See all the pins.\";\n\t\t}\n\n\t\tvar mentionData = client.internal.resolver.resolveMentions(data.content, channel);\n\t\tthis.cleanContent = mentionData[1];\n\t\tthis.mentions = [];\n\n\t\tmentionData[0].forEach((mention) => {\n\t\t\t// this is .add and not .get because it allows the bot to cache\n\t\t\t// users from messages from logs who may have left the server and were\n\t\t\t// not previously cached.\n\t\t\tif(mention instanceof User) {\n\t\t\t\tthis.mentions.push(mention);\n\t\t\t} else {\n\t\t\t\tthis.mentions.push(client.internal.users.add(new User(mention, client)));\n\t\t\t}\n\t\t});\n\t}\n\n\tget sender(){\n\t\treturn this.author;\n\t}\n\n\ttoObject() {\n\t\tlet keys = ['id', 'timestamp', 'everyoneMentioned', 'pinned', 'editedTimestamp', 'content', 'cleanContent', 'tts', 'attachments', 'embeds'],\n\t\t\tobj = {};\n\n\t\tfor (let k of keys) {\n\t\t\tobj[k] = this[k];\n\t\t}\n\n\t\tobj.channelID = this.channel ? this.channel.id : null;\n\t\tobj.serverID = this.server ? this.server.id : null;\n\t\tobj.author = this.author.toObject();\n\t\tobj.mentions = this.mentions.map(m => m.toObject());\n\n\t\treturn obj;\n\t}\n\n\tisMentioned(user){\n\t\tuser = this.client.internal.resolver.resolveUser(user);\n\t\tif (!user) {\n\t\t\treturn false\n\t\t}\n\t\tfor (var mention of this.mentions) {\n\t\t\tif (mention.id == user.id) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\ttoString(){\n\t\treturn this.content;\n\t}\n\n\tdelete(){\n\t\treturn this.client.deleteMessage.apply(this.client, reg(this, arguments));\n\t}\n\n\tupdate(){\n\t\treturn this.client.updateMessage.apply(this.client, reg(this, arguments));\n\t}\n\n\tedit() {\n\t\treturn this.client.updateMessage.apply(this.client, reg(this, arguments));\n\t}\n\n\treply(){\n\t\treturn this.client.reply.apply(this.client, reg(this, arguments));\n\t}\n\n\treplyTTS(){\n\t\treturn this.client.replyTTS.apply(this.client, reg(this, arguments));\n\t}\n\n\tpin() {\n\t\treturn this.client.pinMessage.apply(this.client, reg(this, arguments));\n\t}\n\n\tunpin() {\n\t\treturn this.client.unpinMessage.apply(this.client, req(this, arguments));\n\t}\n}\n"]}