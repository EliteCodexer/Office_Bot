{"version":3,"sources":["../../src/Structures/ServerChannel.js"],"names":["ServerChannel","data","client","server","name","type","position","permissionOverwrites","permission_overwrites","forEach","permission","add","keys","obj","k","map","p","toObject","userOrRole","internal","resolver","resolveUser","ownerID","id","everyoneRole","roles","get","userRoles","concat","rolesOf","userRolesID","filter","v","roleOverwrites","memberOverwrites","overwrite","push","indexOf","permissions","serverRole","deny","allow","resolveRole","user","permissionsOf","mention","setChannelName","apply","arguments","setChannelPosition","updateChannel"],"mappings":"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","file":"ServerChannel.js","sourcesContent":["\"use strict\";\n\nimport Channel from \"./Channel\";\nimport Cache from \"../Util/Cache\";\nimport PermissionOverwrite from \"./PermissionOverwrite\";\nimport ChannelPermissions from \"./ChannelPermissions\";\nimport {reg} from \"../Util/ArgumentRegulariser\";\n\nexport default class ServerChannel extends Channel{\n\tconstructor(data, client, server){\n\t\tsuper(data, client);\n\t\tthis.name = data.name;\n\t\tthis.type = data.type;\n\t\tthis.position = data.position;\n\t\tthis.permissionOverwrites = data.permissionOverwrites || new Cache();\n\t\tthis.server = server;\n\t\tif (!data.permissionOverwrites) {\n\t\t\tdata.permission_overwrites.forEach((permission) => {\n\t\t\t\tthis.permissionOverwrites.add( new PermissionOverwrite(permission) );\n\t\t\t});\n\t\t}\n\t}\n\n\ttoObject() {\n\t\tlet keys = ['id', 'name', 'type', 'position'],\n\t\t\tobj = {};\n\n\t\tfor (let k of keys) {\n\t\t\tobj[k] = this[k];\n\t\t}\n\n\t\tobj.permissionOverwrites = this.permissionOverwrites.map(p => p.toObject());\n\n\t\treturn obj;\n\t}\n\n\tpermissionsOf(userOrRole){\n\t\tuserOrRole = this.client.internal.resolver.resolveUser(userOrRole);\n\t\tif (userOrRole) {\n\t\t\tif (this.server.ownerID === userOrRole.id) {\n\t\t\t\treturn new ChannelPermissions(4294967295);\n\t\t\t}\n\t\t\tvar everyoneRole = this.server.roles.get(\"id\", this.server.id);\n\n\t\t\tvar userRoles = [everyoneRole].concat(this.server.rolesOf(userOrRole) || []);\n\t\t\tvar userRolesID = userRoles.filter((v) => !!v).map((v) => v.id);\n\t\t\tvar roleOverwrites = [], memberOverwrites = [];\n\n\t\t\tthis.permissionOverwrites.forEach((overwrite) => {\n\t\t\t\tif (overwrite.type === \"member\" && overwrite.id === userOrRole.id) {\n\t\t\t\t\tmemberOverwrites.push(overwrite);\n\t\t\t\t} else if (overwrite.type === \"role\" && ~userRolesID.indexOf(overwrite.id)) {\n\t\t\t\t\troleOverwrites.push(overwrite);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar permissions = 0;\n\n\t\t\tfor(var serverRole of userRoles){\n\t\t\t\tif (serverRole) {\n\t\t\t\t\tpermissions |= serverRole.permissions;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor(var overwrite of roleOverwrites.concat(memberOverwrites)){\n\t\t\t\tif (overwrite) {\n\t\t\t\t\tpermissions = permissions & ~overwrite.deny;\n\t\t\t\t\tpermissions = permissions | overwrite.allow;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn new ChannelPermissions(permissions);\n\n\t\t} else {\n\t\t\tuserOrRole = this.client.internal.resolver.resolveRole(userOrRole);\n\t\t\tif (userOrRole) {\n\t\t\t\tvar permissions = this.server.roles.get(\"id\", this.server.id).permissions | userOrRole.permissions;\n\t\t\t\tvar overwrite = this.permissionOverwrites.get(\"id\", this.server.id);\n\t\t\t\tpermissions = (permissions & ~overwrite.deny) | overwrite.allow;\n\t\t\t\toverwrite = this.permissionOverwrites.get(\"id\", userOrRole.id);\n\t\t\t\tif (overwrite) {\n\t\t\t\t\tpermissions = (permissions & ~overwrite.deny) | overwrite.allow;\n\t\t\t\t}\n\t\t\t\treturn new ChannelPermissions(permissions);\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t}\n\n\tpermsOf(user){\n\t\treturn this.permissionsOf(user);\n\t}\n\n\tmention(){\n\t\treturn `<#${this.id}>`;\n\t}\n\n\ttoString(){\n\t\treturn this.mention();\n\t}\n\n\tsetName(){\n\t\treturn this.client.setChannelName.apply(this.client, reg(this, arguments));\n\t}\n\n\tsetPosition(){\n\t\treturn this.client.setChannelPosition.apply(this.client, reg(this, arguments));\n\t}\n\n\tupdate(){\n\t\treturn this.client.updateChannel.apply(this.client, reg(this, arguments));\n\t}\n}\n"]}